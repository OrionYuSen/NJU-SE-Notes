### 云计算复习

#### 云计算概念

##### 发展现状如何？

- 十四五规划“加快推动数字产业化”中将“云计算”位列数字经济重点产业第一位
- 出现了各种各样的公有云平台，如华为云：弹性云服务器，对象存储服务，容器，公网ip等等
- 生活中互联网产品的云化：云游戏，云音乐
- 产业规模逐年增加

##### 计算模式演进

1. 主机计算与集中式计算：资源集中，计算、存储集中
2. 效用计算：按照用量付费；效用计算仅规定了计费模式，不限定技术、管理、配置、安全
3. 客户机/服务器模式：云计算的客户同样通过网络与远处的云端相连，区别是远程服务器拥有近似无限的存储容量，永远不会崩溃
4. 集群计算：用紧密耦合的一组计算机来达到单个目的，云计算需要达成不同的目的。集群式计算是要有限度的分布式计算，不考虑交互式的终端用户。
5. 服务计算：软件即服务，将应用程序作为服务提供。服务之间相互独立，松散耦合。服务计算不一定在云中提供，仅限于saas。
6. **分布式计算**：依赖于分布式系统，范畴比云计算要大
7. 网格计算：应用于复杂科学计算，只用于学术领域，不考虑交互式终端

总的趋势：集中->分散->集中

##### 云计算优势

- 规模效益**降低计算成本**。
- 弹性资源配给，**提高资源利用率**。
- 计算资源无限
- 随时都能使用

##### 云计算和别的技术的关系

大数据促进了云计算的产生，激发了云计算的潜力；云计算为大数据的收集、存储、 加工和应用提供了更好的支持。处理海量的数据需要海量的存储和海量的计算能力。

云计算提供了算力、存储、和网络资源。

##### 云计算的发展动力和优化动力

###### 发展动力

1. 网络带宽的提升
2. 技术成熟度
3. 移动互联网的发展：网路终端数目增加
4. 数据中心的演变：数据中心面临昂贵的管理成本，能源消耗等等挑战
5. 经济因素：降低成本，节约资源，可持续发展
6. 大数据

###### 优化动力

1. 提高资源利用率，节能降耗
2. 降低信息系统的维护成本
3. 提升资产安全
4. 提升信息系统的容灾备份能力

##### 云计算的开源价值观

##### 云计算的定义

###### 一种商业模式

saas，iaas，paas

###### 一种计算范式

1. 云体逻辑结构 计算存储通信
2. 云栈逻辑结构

###### 一种实现方式

1. 数据中心加云平台管理系统
2. 软件定义数据中心	

#### 云计算架构

极致的面向服务的计算架构：一切资源以服务的形式对外开放 IT即服务

##### 概念架构

- 基础设施+应用程序
- 前端+后端
- 呈现给用户的界面+云组件

##### 逻辑架构

###### 云体

- 是云计算的物质基础，是云计算使用的**资源集合**，是构成云计算的**软硬件环境**，例如网络、服务器、存储器、交换机等。广义的云体包括数据中心机器辅助设施如电力、空调、机架、 冷却等系统。
- 目前可以认为：云体就是数据中心

###### 云栈

又称云平台，是在云上建造的**运行环境**。它能够支持应用程序的发布、运行、监控、调度、伸缩，并为应用程序提供辅助服务机制，如访问控制、权限管理等。

##### 物理架构

云体和云栈实际上是什么 云数据中心＋云操作系统（open stack）

#### 云数据中心

##### 网络拓扑

- 树形：FatTree，VL2
- 光交换：OSA
- 无线网络：WDCN
- 递归：DCell，Ficonn，Btube，MDCube

##### 绿色节能技术

- 配电系统节能
- 空调系统节能
- 集装箱数据中心节能技术
- 管理系统节能策略和算法
- 新能源应用

##### 自动化

按需分配和收回服务器、存储、网络、应用程序

##### 容灾备份技术

核心：复制数据

远程镜像技术，快照技术，基于IP的SAN的远程数据容灾备份技术， 数据库复制技术

#### 虚拟化技术

##### 定义和目的

虚拟化是对资源的抽象，把物理资源映射为虚拟资源，实现多用户共享物理资源。

虚拟化可以提高资源的利用率，降低软硬件的耦合度，方便大规模的部署和调度。

##### 不同层次虚拟化产物

- 应用程序：VMWare ThinApp，JVM
- 程序库API：WINE
- 操作系统：Docker
- 硬件级：VMWare
- ISA：Bochs

性能：操作系统最高，硬件级虚拟化由于需要经常在用户模式和特权模式切换，性能有损耗

应用程序灵活性（在对应虚拟环境下，可以安装或执行的应用程序类型的多样性程度）：ISA最高，越往上越差

实现复杂度：硬件级和应用程序级最高

应用程序隔离性（不同应用程序能够直接访问的共享资源的程度）：硬件级和应用程序级最高

##### 虚拟化方式

- 基于软件的全虚拟化：效率较低
- 改操作系统的半虚拟化
- 硬件辅助的虚拟化：插入新的特权级，让硬件可以直接解决客户机操作系统的需求

##### 云数据中心的存储虚拟化

###### 概念

存储虚拟化将系统中**分散**且**异构**的存储资源整合起来，形成一个统一的**连续编址**的**逻辑**存储空间

###### 基于主机的存储虚拟化

性价比比较高；性能下降，可扩展性差，不支持异构平台

###### 基于存储设备的存储虚拟化

存储子系统与主机无关，对系统性能的影响比较小，较容易管理；对于包含异构存储设备的SAN存储系统，虚拟化方法的效果不好，设备规模有限并且不能进行级联，可扩展性较差

###### 基于网络的存储虚拟化

基于路由器的虚拟化在性能、效果和安全方面都更好；路由器的冗余能够支持动态多路径；连接主机到存储网络的路由器出现故障导致与故障路由器连接在一起的主机受到影响

##### 虚拟机迁移的策略 

- Stop-and-Copy：A停机，将对应内存全部复制到B，启动B。方法比较简单；总迁移时间也最短；停机时间无法接受
- Stop-and-Copy和Pull阶段结合：A停机，将部分内存复制到B，启动B，B运行中遇到缺失内存，再到A内存中复制。停机时间很短；总迁移时间很长；Pull阶段复制造成的性能下降，用户体验差
- Push和Stop-and-Copy阶段结合：A不停机，保持对外服务，将变化地内存迭代地复制到B，直到最后剩余很少要复制的再停止A，复制最后变动到B，启动B。平衡了停机时间和总迁移时间之间的矛盾；需要有一种算法能够测定工作集，以避免反复重传；可能会占用大量的网络带宽，对其他服务造成影响

#### 云操作系统

##### 核心组件及交互

计算服务Nova，负责管理虚拟机

镜像服务组件Glance，管理镜像

对象存储组件Swift，用标准的硬件进行PB级的安全、可靠的存储

Nova通过Glance创建和管理镜像快照，通过Swift存储快照

##### Nova被拆分成许多互不影响的部件，体现了开源、灵活、可拓展性（组件/节点）

##### 无状态的架构

同一用户的不同请求可以被不同的云控制器处理，有利于负载均衡；

##### 无中心架构

不会有单点故障，高可用集群替代单台机器

##### 不同节点架构

Controller: Keystone, Nova管理组件(Nova-api, Nova-conductor, Nova-scheduler), Glance, 网络服务,  仪表盘服务，计量服务

Network: Networking ML2 Plug-In, Layer2,3,4 agent 

Compute: Nova-compute, Networking, Hypervisor(VMM), Magum

Storage: Block Storage Cinder, Object Storage Swift。

swift是哈希环，且只有一个层次，查询效率高

cinder把存储空间分块，但用户还不能直接使用，需要安装文件系统

##### 网络虚拟化组件

管理网络 不算在计费中

租户网络 算在计费中

存储网络 虚拟机和存储通信的网络

网络节点 虚拟的路由器 连接多个虚拟的网络 使用Neutron组件

#### 分布式计算

##### ACID

- 原子性(Atomicity)-事务中所有操作要么全都做完，要么都不做；只要一个操作失败，事务就失败，要回滚
- 一致性(Consistency)-数据库要处于原本的一致性状态
- 独立性(Isolation)-并发的事务不会相互影响，读数据不受影响，写数据也不能受到影响
- 持久性(Durability)-一旦事务提交后，它所作的修改应该永久保存在数据库上，即使宕机也不会丢失

##### CAP

一个分布式系统最多能够同时满足一致性(consistency)、可用性(Availability)、分区容错性(Partition tolerance)中的两项

##### BASE

- Basically Available：基本可用-系统出现故障时，允许损失部分可用性，保证核心可用
- Soft State：软状态：允许系统存在中间状态，但中间状态不会影响系统的整体可用性
- Eventual Consistency：最终一致性-所有数据副本经过一定时间后，能最终达到一致的状态

##### 类型

分布式计算系统：Hadoop-MapReduce, Spark, Flink

分布式存储系统：Ceph, Hadoop-HDFS

分布式资源管理系统：Hadoop-Yarn

